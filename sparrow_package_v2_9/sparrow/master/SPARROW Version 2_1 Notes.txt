SPARROW Version 2.1 Revision Notes

sparrow_header.sas

  Installed a switch to allow user to turn off indata creation if there has been no
  change in the underlying data in successive runs of the model. As part of this
  installation, provided checks that indata (and ancillary files) exists. Otherwise
  the program terminates with an error message.

  Expanded instructions for using the calibration testing switch.

  Included an additional specification of the other beta coefficient list.

  Included specifications for reach decay, resservoir decay and incremental delivery factors to be
  used by the calibrate and prediction macros.

  09/17/03 - Changed the name of the macro variable identifying the link to the Reach map from arcnum
  to arcid.

  03/15/04 - Added specification for if_gis to control if gis is to be included in the analysis.

  03/15/04 - Declared the options home_gis, target, lat, lon, and arcid to be optional.

  04/01/04 - Modified the incr_delivery_specification to include the delivery design matrix.

  04/21/04 - Modified the instructions to the test_obs control variable to include the option
  of specifying a list of observations to generate test output for multiple reaches.

  12/04/04 - Control file now admits Bcol/yr for load_unit. Note that this automatically
  expresses concentration units in col/100ml, the if_concentration_in_micrograms switch is disabled.


sparrow_main.sas

  Improved the error tagging and trapping throughout the main macro. Installed the 
  operative part of the switch that allows user to skip setting the data on
  successive runs of the model.

  Moved the initialization of the iter and jter variables to the top of the main macro
  to provide values for these variables in the case there is an error message.

  01/15/04 - Modified the main macro to execute the summarize_calibrate macro only if the
  bootstrap analysis was not a parametric bootstrap. The parametric bootstrap results will
  simply reproduce the asymptotic results in this case and so they are not needed.

  03/15/04 - Modified to include a marco to assign the libnames - the libname for the gis
  directory is only assigned if if is specified in the header file.

  03/22/04 - Modified the code that acquires the bootstrap betaest estimates in the case
  that there is no estimation so that the value of jter is passed from the boot_betaest_all
  file.

  04/20/04 - Modified the macro main to include the SAS file test_resids in the estimation backup.

  12/15/04 - Modified the macro main to include a check of the model variables for inclusion in
  indata and any missing values. The algorithm now creates indata, checks the model variables,
  and then sorts the data.

  12/15/04 - Modified the backing up of results data sets to backup the comment_all file 
  whenever iteration zero is processed. Formerly, the file was backed up only if iteration zero,
  if there were no errors, and if estimation was occurring. This fixes a problem in which
  mulitple runs of the program appended error messages to the comment file that made it
  difficult to determine which errors applied to which run.

  12/20/04 - Modified by creating two new output external files stored in the home_results
  directory: summary_model_specs.txt and summary_model_rslts.txt. These files contain a summary
  of the model specification derived from the control file specifications and a summary of 
  the estimation results. Each estimation of sparrow causes a specification and results
  table to be appended to the existing files. Amended the code in the main estimation loop
  that calls %calibrate, to also call the macro %model_summary which writes the summary
  model specifications (the summary model results are written in the %calibrate macro).

  05/11/05 - Modified the code to no longer call the generate_parm_bootstrap macro. The
  functionality of generate_parm_boot is now included in the macro calibrate.

  06/07/05 - Added gbt_pred_vs_resid gbt_pred_vs_wresid gbt_pred_yld_vs_wresid
  to the list of catalogs to backup and delete.

  07/07/05 - Modified all %if clauses that refer to control variables to use upper case comparison.

  02/10/06 - Modified %backup(dir_rslt,comment_all) to %backup(dir_rslt,comment_all,data). This
  corrected an error in which the comment_all file was not receiving backup.

  04/14/06 - Modified the main macro by moving the back up of the comment file to before %makelst
  so that messages that are created from makelst are not subsequently removed from comment_all.

  04/14/06 - Modified the main macro by changing some of the error flagging and messages printed if
  you encounter a problem with the availablity of calibration results prior to prediction.

  07/12/06 - Added condition to check error status before running model_summary in the main macro.
  Added macro check_dir to check for the existence of a directory. Added code to set_libraries macro
  to check for the existence of the directories before assigning libnames. The revised code creates
  an error flag if the necessary directories are not present. If the GIS directory is not found,
  the analysis does not terminate but a warning is posted. Moved the setting of options to the
  top of the list of macros. Moved the setting of libraries to the main macro (after the iter
  and setting of if_error).

  12/13/06 - Added statement in main macro to execute the macro make_nested_area (see setdata).
  This adds the variable nested station area to the station_data file.

  12/13/06 - Added statement in main macro to execute the macro check_station_vars (see setdata).
  This macro checks to see if the station variables file has any missing values for critical station
  variables, such as the staid or ls_weight variables. The macro also notes, but does not error flag,
  if a monitored reach has no lat/lon, thereby causing the flux to be dropped from the map of station
  residuals.

  2/1/07 - Modified the main macro by adding the file boot_detail to the list of SAS files to be
  backed up at the beginning of a SPARROW prediction run. See notes for this date in 
  sparrow_compile.sas for a description of the contents of this file. The creation of this file
  is presently undocumented, and will only be activated if code is modified in the 
  sparrow_compile.sas file.

  6/6/07 - Modified the main macro to include the file error_report in the backup function.

  10/25/07 - Modified macro clear_data to delete new data set model_parm_predict. This supports the
  corrections to the bootstrapping of confidence intervals (see modifications to sparrow_compile).

  10/25/07 - Modified main macro: added the data set mean_delivery_vars to the list of 
  data sets to be backed up. This facilitates the inclusion of mean_delivery_vars as a permanent
  SPARROW output data set.


sparrow_makemacros.sas

  Added code to create a list of the OTHER coefficients.
 
  Installed some checking logic at the top of the makelst macro to check the 
  specification of the model prior to execution. Code checks that:

  - there are equal numbers of source/delivery/decay/reservoir variables and 
    associated coefficients. Program terminates on error.

  - all elements of the source/delivery/decay/reservoir/other coefficients are included
    in the betailst statement. Program terminates on error.

  - checks for any coefficients in the betailst that are not in the combined 
    source/delivery/decay/reservoir/other coefficient lists. Prints a warning if there
    are extra coefficients in the betailst, but program is not terminated.

  - checks that the dlvdsgn matrix has equal number of elements in each comma-delimited
    segment, that there are the same number of comma-delimited segments as source
    variables, and that there are the same number of elements per comma-delimited
    segment as delivery variables.

  Added two macros at the top of the program - count and check - that support the
  specification checking logic. Count determines the number of space-delimited
  items are in a macro variable list. Check identifies items in an input list
  (ListA) that are not found in a source list (ListB). Returns a list of 
  excluded items.

  Included jwaterid and jstaid to the global list (used in calibration).

  Fixed macro makelst to override the if_estimate = no switch if the file 
  dir_rslt.boot_betaest_all exists (prioviou version tested erroneously for
  the file dir_rslt.boot_betaest).

  Modified the macro check to be insensitive to upper and lower case in 
  checking for any variables that are on ListA but not on ListB.

  Modified code that defines the macro variable datalst so that the decision
  to add a variable name to datalst does not depend on case.

  Added a macro variable LU_class_length that contains the maximum character length
  of the land use class name to be used in the Yield by Land Use table output.

  09/17/03 - renamed the macro variable &arcnum to &arcid.

  12/05/03 - Modified the makelst macro by adding the total drainage area variable 
  to the list of variables in the datalst and created an additional column index - jtotarea.
  Included jtotarea to the globvar macro.

  03/15/04 - Modified the setdata macro to create labels for lat, lon and target only if
  they are defined macro variables.

  04/01/04 - Modified assignment of globvar to include the dlvdsgn matrix.

  04/22/04 - Modified the 

  05/14/04 - Included code to compile a list of unique variable names to be retained in 
  the indata data set. This shortens the time used to set indata.

  12/06/04 - Modified global statement to include numerator_load_units and concentration_units.
  numerator_load_units are the units in the numerator of the load_units assignment. Modified
  the adjust_conc_units code to automatically assign a factor of 100 if load_units are Bcol/yr.

  12/15/04 - Modified code to specify the macro variable model_vars_list consisting of the
  critical model variables that must be checked for any missing values. Model_vars_list was
  added to the global statement.

  12/20/04 - Added three new macros to the makemacros suite: form_it, delim_it and model_summary.
  These macros append the model specifications to an external file summary_model_specs.txt.
  Form_it and delim_it are called by model_summary. Model summary is called from main.

  01/06/05 - Added concentration_units to the global statement in the makelst macro.

  01/31/05 - Modified the check for the dlvdsgn matrix to only be performed if there are
  specified delivery variables. If there are no delivery variables, no check is performed.

  07/05/05 - Modified the form_it and delim_it macros to use %" instead of " in defining outtext.

  07/07/05 - Modified all %if statements referring to control variables to use an upper case comparison.

  02/13/06 - Modified the concentration_units macro variable: liters is now abbreviated 'L' instead of 'l.'

  04/14/06 - Modified makelst macro code regarding the setting of if_estimate to yes if the 
  files dir_rslt.summary_betaest and dir_rslt.boot_betaest_all are not both found to write a
  warning to the comment file that if_estimate is being run, and why.


sparrow_calibrate.sas

  Included three new modules in the macro calibrate: test_neg, e, test_singular.

  - test_neg
      determines if a column vector has any negative values. If negative
      values are found, a warning message is printed and the first occurance is listed.
      This module supports improved testing of the model in testing mode (see below).

  - e
      creates a row vector of N elements, elements are all zero except for a 1 in
      the ith element. Supports the module test_singular.

  - test_singular
      a NxN square symmetric input matrix A is tested for singularity using the ginv(A)*A
      evaluation which puts off diagonal elements to non-zero if there is co-linearity and 
      diagonal elements to zero if there is a zero-ed row and column. Output from the 
      module is an RxN matrix of zeros and ones, where R is the number of independent 
      co-linear groupings. Elements coded 1 along a row signify the location of a
      row/comun that forms a co-linear grouping. If the matrix is non-singular the module
      returns a null matrix. Supports a new capability to detect singularity of the 
      second-order derivative matrix (used to compute the coefficient covariance matrix).

  Added improved test results that can be displayed if the model is in calibration testing
  mode. The program will print a message and additional information if any reach has a negative
  reach delivery, reservoir delivery or incremental stream loading. Additionally, in
  calibration testing mode the program flags any negative value for accumulated reach load.

  Included a test of singularity of the second-order derivative matrix h from the nlfdd routine.
  Singular h matrices may arise if there is colinearity among source/delivery/decay/reservoir
  variables, or if one of these variables is set to zero. The program will determine groupings
  of colinear coefficients (more precisely, colinearity of the derivatives of the model with respect
  to the coefficients). However, no correction of the singularity is attempted so the program
  will terminate with an error.

  Fixed an error in the feval module that evaluated the reservoir delivery factor: needed to post multiply
  by the transpose of beta[,jbresvar].

  Modified the reach decay, resservoir decay and incremental delivery factor to use a user-specified 
  function defined in the header file.

  Fixed a bug in the feval module that was activated when test mode was on. There was a missing end statement
  associated with a do group.

  12/05/03 - Added code to compute the r-squared for yield and to print it in the output and copy it to the
  output file. Modified feval to compute log of predicted yield and output with other outdat variables on 
  the final pass. Modified the column names for the summary_betaest and resids output to include the additional
  variables.

  12/24/03 - Modified the code to compute the VIF and eigenvalues to use non-centered values if the SPARROW model
  does not have an intercept. The output has an (NC) appended to the VIF and eigenvalues listing to denote
  non-centered estimates. The effect of non-centering will raise VIF.

  12/24/03 - Changed the criteria for detecting a singular matrix in the test_singular module from 1E-12 to 1E-9. 
  This removes the erroneous singular warning obtained in the example program.

  01/16/04 - Modified the calibrate macro to execute relevent code only if the macro variables reach_decay_specification,
  reservoir_decay_specification, and incr_delivery_specification have non-zero length. This removes an error that
  arises if, for example, there is no reservoir process and so no reservoir decay process is specified.

  01/27/04 - Modified the formula for computing the probability plot correlation coefficient: the quantile used for plotting
  position is (rank - .4)/(nobs + .2) (rather than nobs + 2). 

  01/28/04 - Modified the calibrate macro to output the gradients for each coefficient to the resids file. Constrained 
  coefficients have a zero gradient.

  03/12/04 - Modified the feval module by testing the length of the bquote of the macro variables representing
  the rchdcayf resdcayf and inddsrc specifications. This corrects a message recieved when an assignment
  has an incorrect number of parentheses. Effectively, the bquote function removes the interpretation of
  the parentheses during program compilation.

  03/30/04 - Modified the read commands for importing the SAS data to apply the "where" option only if the 
  calibration selection criteria are present and to apply the same criteria to the importing of the weights. This
  avoids a potential problem that may arise if the selection criteria did not take all observations with monitored
  flux.

  04/01/04 - Included a command to create the matrix dlvdsgn from the macro variable &dlvdsgn. Modified the
  creation of the incremental delivery factor to assume the dlvdsgn matrix is included in the control file
  specification rather than hard coding it into the feval module.

  04/02/04 - Modified the feval module to base the computation of the reach decay, reservoir decay and land
  to water delivery factors based solely on the existence of the control variable specification. This allows
  SPARROW to estimate a delivery process without having to explicitly declare any variables for that process.
  Also fixed the incddsrc computation for the case where there is no land-to-water delivery to include stream
  decay. 

  04/02/04 - Add printing of iftran, carryf and upstream node flux to the test estimate output.

  04/27/04 - Modified the feval module in the macro calibrate to apply the iftran variable to the amount
  of rchld that is passed to the downstream node. Only affects results if the dll is turned off. Change
  makes the estimation between dll and non-dll the same.

  09/20/04 - Modified the code that does test calibration to include the setting of n_rch_decay to zero 
  if there are no reach decay variables (jdecvar = 0). Did the same for n_incddsrc. This fixes an error
  that arose if there were no decay variables or no incremental delivery variables under test mode.

  12/20/04 - Modified the calibrate macro to append a summary table of results to the external file
  summary_model_rslts.txt. The output table resembles the standard SPARROW regression output but
  includes an additional column representing the eigen vector corresponding to the minimum eigen
  value in the eigen system representation of the (non) centered normalized X'X matrix. Also, the
  table includes the value of the minimum eigen value from this system. 

  05/12/05 - Modified the calibrate macro to generate parameter estimates using the parametric bootstrap 
  if requested. This task was formerly done as a separate macro. The generated parameters are used to 
  generate errors and an estimate of the retransformation factor (mean_exp_weighted_resid), which is then
  written to the boot_betaest file.

  07/07/05 - Modified all %if statements for control variables to use upper case comparisons.

  02/10/06 - Fixed error that caused termination due to incompatible matrices when estimating the parametric
  bootstrap. Error was caused by an erroneous parameter = {&betalst} statement. The erroneous statement
  was deleted.

  02/13/06 - Modified the title printed with the nonlinear least squares results: removed the hyphen.

  04/07/06 - Modified calibration code to flag cases in which a non-positive load at a monitored reach
  is encountered. A matrix of conditions is created for each occurrenc and the matrix is passed to
  the file ERROR_REPORT in the WORK directory. A warning message is also printed alerting the user
  to the problem. The "Division by zero" message is no longer generated.

  11/20/06 - Modified call symput('flag_zero_load',trim(left(1))) ;
  to read: call symput('flag_zero_load',trim(left(char(1)))) ;
  This fixes an error that ocurred due to 1 being numeric.

  6/6/07 - Expanded the error message given when the file error_report is created.


sparrow_predict.sas

  Fixed an error in the feval module that evaluated the reservoir delivery factor: needed to post multiply
  by the transpose of beta[,jbresvar].

  Modified the reach decay, resservoir decay and incremental delivery factor to use a user-specified 
  function defined in the header file.

  09/22/03 - Modified the code in the feval_predict module by creating the vector inc_decay which is the
  in-stream (and reservoir) decay applied to incremental loads to determine the load leaving the reach.
  The del_frac was modified to include this incremental decay. Therefore, the delivery fraction now
  incorporates the instream and reservoir decay received by the incremental loads in their transport to
  the nearest downstream target reach (not just the decay applied upon leaving the reach). 

  12/05/03 - Modified the feval module by making a small change in the algorithm for computing the
  delivery fraction. Moved the application of the incremental decay (the decay for the reach from its
  midpoint) to after the value of decay is passed to the upstream node. This corrects a problem in
  which reaches were getting half of the reach decay double counted.

  03/12/04 - Modified the feval module by making the commands creating the vectors rchdcayf, resdcayf,
  and incddsrc consistent operative only if the corresponding macro variable specifications are defined.
  This makes the prediction algorithm the same as the calibration algorithm. This does not affect any 
  results but removes an error message being printed.

  03/12/04 - Modified the feval module by testing the length of the bquote of the macro variables representing
  the rchdcayf resdcayf and inddsrc specifications. This corrects a message recieved when an assignment
  has an incorrect number of parentheses. Effectively, the bquote function removes the interpretation of
  the parentheses during program compilation.

  03/15/04 - Modified the feval module within the predict macro to compute the delfrac only if 
  jtarget is non-zero. This allows the program to execute if a target has not been specified.

  04/01/04 - Included a command to create the matrix dlvdsgn from the macro variable &dlvdsgn. Modified the
  creation of the incremental delivery factor to assume the dlvdsgn matrix is included in the control file
  specification rather than hard coding it into the feval module.

  04/02/04 - Modified the feval module to base the computation of the reach decay, reservoir decay and land
  to water delivery factors based solely on the existence of the control variable specification. This allows
  SPARROW to estimate a delivery process without having to explicitly declare any variables for that process. 

  04/21/04 - Modified the feval module in the predit macro so that multiple test reaches can be selected and 
  output to the test_data data set.

  08/31/04 - Modified the feval module in the predict macro so that the square root of the incremental 
  decay is included in the computation of the delivery fraction. Before the change, the delivery fraction
  included the own-reach decay only for target reaches. The modification causes the delivery fraction to
  include all downstream decay including the own reach decay.

  02/09/06 - Modified the prediction macro to read the mean_exp_weighted_error variable from the boot_betaest
  file rather than from the summary_betaest file. This applies a retransformation factor that is bootstrap-
  replication specifc as opposed to using the same retransformation factor across all bootstrap replications.

  09/12/07 - Modified the predict macro: Placed macro variable conditioning statements so that the matrix
  exclude list is set to 0 if &retrans_exclude_list is null. The checks placed in the function locin were
  not sufficient to handle the case where &retrans_exclude_list is null.


sparrow_create_gis.sas

  Added a macro that allows you to easily view previously created results using previously
  created coverages. The new switch "if_previous" selects this option. Use this option
  to quickly view previously created results in SAS GIS.

  08/29/03 - Added code to delete the SAS GIS files and catalogs prior to loading the export
  coverages. This overcomes an error that occurred whenever SAS tried to overwrite these files.
  Note that to include this code, it was necessary to include a data step before the DM command
  or the program would partially hang. Also included instructions for obtaining the layer names
  SAS creates when the export file is loaded into SAS/GIS. Note that the method for obtaining 
  the names is cumbersome and takes considerable time, but this is the only solution I've found.

  09/17/03 - Changed the name of the variable linking the predict SAS dataset with the Reach Map
  coverage from arcnum to arcid. Also made a small edit to the instructions at the top of the
  program.

  09/22/03 - Modified the instructions to include instructions for setting the color of the 
  Missing category in the Reach Map. Changed the color definition for the default to the color
  CXBABABA.
  
  09/29/03 - Wrote three new macros: delete_previous, get_layer_name, and n_obs. delete_previous
  deletes a previous SAS/GIS coverage (note that the algorithm must include a data _null_
  command after the proc datasets and proc catalog statements to get these procedures to
  terminate prior to the DM command in the create_resids_map and create_reach_map macros. The 
  get_layer_name macro aquires the layer names from the imported coverages. Therefore, it is
  no longer necessary to specify the layer names prior to running the program. Also, modified
  the code that creates a sample residuals file or predict file if these files are not 
  available. The modified code creating the residuals file creates random locations within
  the confines of the resids_back spatial extent (which is determined from the xmin,xmax,ymin,
  ymax of the first record of resids_backc). The modified code creating the predict file
  creates random delivery variables for the minimum of 100 reaches or the number of reaches
  in the reach_map coverage (determined by the number of observations in the reach_mapc
  data set).  

  05/24/04 - Modified the name of the residuals plot from Studentized Residuals Map to Standardized
  Residuals Map.

  07/07/05 - Modified %if statements referring to control variables to use the upper case comparison.


sparrow_compile.sas

  Corrected an error in the macro summarize_calibrate. In computing the ci_lo and ci_hi in the module boot_clip, 
  the parametric estimate p_beta needs to be pre-multiplied by 2 before subtracting the bootstrap coefficient.
  The original code did not pre-multiply by 2, which is consistent with the documentation only if the bootstap
  estimates represent deviations from the parametric estimate. Without this differencing, the pre-multiplication
  factor 2 must be applied.

  Modified the macro summarize_calibrate to include a new module boot_pval which takes a kx1 vector of parametric
  coefficient estimates and a Bxk matrix of bootstrap estimates to compute a kx1 vector of probability values using
  the method developed by Noreen. This p-value is now used in place of the originally programmed p-value which
  based its estimate on a t statistic computed from bootstrap summary statistics.

  12/05/03 - Modified the compile_calibrate macro to include labels for the yield r-square in summary-betaest data
  set and the predicted ln yield variable in the resids data set. Also modified labels for the predicted ln flux and
  ln resids in the resids data set.

  03/15/04 - Modified the compile_calibrate macro to do %make_gis only if the if_gis variable is set to yes
  and there is a valid home_gis directory.

  03/22/04 - Modified compile_stats to include inputting and outputting the iteration number to the predict_stats file.

  04/19/04 - Modified the macro compile_ci by deleting the permanent SAS data set predict_stats after compiling all
  the confidence intervals. The macro compile_ci_get_bounds merges the bootstrap mean and variance statistics from
  predict_stats into the data set predict (one prediction variable pre macro call of compile_ci_get_bounds). After
  all the prediction variables have been loaded, there is no need to retain predict_stats, so it is deleted.

  04/20/04 - Modified the compile_calibrate macro by changing the title for the boot_resid variable in the
  resids data set (dropped -LN Retrans factor).

  04/20/04 - Modified the macro compile_calibrate to include outputting the text file test_resids if
  testing of estimation is done.

  04/26/04 - Modified the macros compile_ci_set_storage and compile_ci_add_data by changing the way the 
  boot_errors is computed. The change divides the randomly selected exponentiated error by mean_exp_weighted_error. 
  When boot_errors is multiplied by the prediction, this negates the retransformation factor present in the 
  prediction estimates coming out of the predict algorithm. The old equation incorrectly subtracted the log 
  value of mean_exp_weighted_error. Also, in the compile_ci_set_storage macro, the residual read from the
  resids file is changed from weighted_ln_resid to boot_resid. This is now consistent with how compile_ci_add_data
  works.

  05/06/04 - Removed the deletion of dir_rslt.predict_stats from the macro compile_ci and moved it to
  the macro summarize_predict. This fixes an error caused by the predict_stats file being prematurely
  deleted. Also reordered the macros to place summarize_calibrate after compile_calibrate.

  05/24/04 - Modified label for residual from Studentized to Standardized.

  12/06/04 - Modified the units by removing &adjust_units and making all yields in 
  &numerator_load_units./ha/yr. Thus, if loads are in mt, the yields will be mt/ha/yr. Modified the
  concentration units determination to be given by the macro variable &control_units, which is 
  set in makemacros.

  07/07/05 - Modified %if statements referring to control variables to use the upper case comparison.

  09/27/05 - Modified make_stats: normalized the computation of the sampling error variance in cv_error
  using parm_predict rather than m_boot_predict (see documentation for derivation). 

  02/09/06 - Modified the macros compile_ci_set_storage and compile_ci_add_data to read the value of
  mean_exp_weighted_error from the boot_betaest file (where mean_exp_weighted_error is recomputed for
  each bootstrap iteration based on the current iterations bootstrap coefficient estimates). The
  bootstrap iteration estimate of mean_exp_weighted_error is used to negate the retransformation factor
  inherent in the bootstrap iteration prediction estimate (the value inputed from the predict data set).
  Negation of the retransformation factor is necessary because the confidence interval uses randomly
  assigned errors rather than the expected exponential error. The prediction algorithm now bases bootstrap 
  prediction on the bootstrap estimate of mean_exp_weighted_error instead of the parametric estimate. 
  Therefore, it is necessary to use the bootstrap estimate to negate the retransformation factor in the 
  confidence interval estimation.

  02/13/06 - Modified the summarize_predict macro: the printing of Flow-weighted conc now uses the
  units given by the macro variable &concentration_units rather than mg/l.

  02/16/06 - Modified macro out_tab in compile: directed log to output file during proc export to
  prevent the proc export messages from being written to the screen.

  10/26/06 - Modified summarize_calibrate by fixing a bug in bootstrap p-value that caused the p-value for 
  negative coefficients to equal 1 - correct value.

  2/1/07 - Modified macro compile_ci_set_storage and compile_ci_add_data to optionally output bootstrap 
  iteration estimates for selected prediction variables and a subset of reaches, based on the specification 
  of the undocumented control variables boot_detail_reaches and boot_detail_predvars specified at the top 
  of the sparrow_compile.sas file. If detailed bootstrap output is requested (see comments above the 
  boot_detail_reaches and boot_detail_predvars control variable specifications) SPARROW creates the file 
  bood_detail in the results directory containing detailed bootstrap iteration output for selected reaches. 
  These files can be used to create other output prediction variables, including large basin incremental 
  delivered flux. Also added code at the end of the summarize_predict macro to reconfigure the 
  boot_detail file so it has columns for individual prediction variables.

  10/25/07 - Made a number of corrections to the confidence interval bootstrapping algorithm. The corrections
  make the program fully compatible with the documentation. Created the macro set_model_parm_predict that
  creates the data set model_parm_predict used to evaluate the numerator of the CI. According to the
  documentation, the numerator does not include mean_exp_weighted_error. The inclusion of this new
  data set allows the evaluation of the model component of the parametric prediction (that is, without the
  mean_exp_weighted_error adjustment) to be done once for all subsequent evaluations of the bootstrap
  confidence intervals (which are done separately by prediction variable). Modified the macro 
  compile_ci_get_bounds to use the model_parm_predict data set rather than dir_rslt.predict as the source
  for the parametric predictions. Modified the macros compile_ci_set_storage and compile_ci_add_data by
  placing a negative sign before the randomly selected bootstrap model error term. This makes the 
  bootstrap simulation of the necessary distribution consistent with the documentation. The change has 
  little effect if the distribution of errors is approximately symmetric. 


sparrow_setdata.sas

  Modified the init_beta macro to use previous estimates to initialize the beta estimates if iter = 0
  and the header switch if_init_beta_w_previous_est is set to yes.

  Changed the setdata macro to allow the length of the LU_class variable created in the indata data step
  to be set by the LU_class_length macro variable.
 
  Moved the length command for LU_class to inside the %if conditional statement so that it is applied only
  if a Land Use analysis is requested. This will stop the message LU_class is uninitialized and the error
  message that the LU_class_length macro variable is not specified when there is no land use analysis.
 
  09/17/03 - renamed the macro variable &arcnum to &arcid.

  03/05/04 - Modified the setdata macro so that the LU_class variable is only referenced in the data
  step if distribute yield by land class has been requested in the header file.

  03/15/04 - Modified the setdata macro to create labels for lat, lon, and target only if variables are specified.

  05/14/04 - Included a keep statement in the creation of indata, where the kept variables are defined by
  a macro in the sparrow_makemacros.sas suite of macros.

  09/16/04 - Removed the command &ls_weight = . ; before the inclusion of the data modifications. Included
  the command if &datavar <= 0 then &ls_weight = . ;

  12/15/04 - A series of macros, check_vars, check_missing_preproc, check_missing_postproc, and check_model_vars
  were included in sparrow_setdata to perform a series of checks on the model variables to determine if (a) they
  are on the indata data set, and (b) if they contain any missing values. Additionally, all the sorting
  operations in the setdata macro were moved to a separate macro step to be executed once the data had passed
  without error through check_model_vars.

  07/07/05 - Modified all %if statements referring to control variables to use the upper case comparison.

  07/14/06 - Added two new macros exclude_list and check_numeric to determine if critical model variables
  are properly coded as numeric variables. Macros are invoked in the macro check_model_vars, where the first
  occurrence determines if any variables named by individual control variables are incorrectly specified, and
  the second occrerrence determines if any remaining model variables are incorrectly specified.

  12/13/06 - Added the new macro make_nested_area which computes the nested area for each monitoring station
  and merges this variable in with the station_data file.

  12/13/06 - Added the new macro check_station_vars. This macro checks to see if the station variables file 
  has any missing values for critical station variables, such as the staid or ls_weight variables. The macro 
  also notes, but does not error flag, if a monitored reach has no lat/lon, thereby causing the flux to be 
  dropped from the map of station residuals.

  10/25/07 - MOdified the macro mean_adjust_delivery_vars to save the mean_delivery_vars data set to the
  permanent results directory and use this data set except in cases where the a new estimation is requested.
  This modification was required because if if_estimate is no and model prediction includes only a subset of 
  the reaches used in model estimation, then computing mean delivery variables from the subset of reaches makes
  the means inconsistent with the means that were used to estimate the model coefficients - resulting in biased
  predictions.


sparrow_graphs.sas

  12/24/03 - Modified the graph_resids macro to plot the residuals vs. predicted yield (or weighted residuals vs. predicted 
  yield if weighted least squares is performed).

  03/15/04 - Took the code updating the GIS coverage and make it a separate macro.

  03/15/04 - Modified graph_resids macro to check for existence of lat lon before renaming.

  04/16/04 - Modified the titles to the graphics plots by changing the word "Load" to "Flux".

  04/22/04 - Modified the graph_resids macro to send the weighted residuals vs. predicted yield plot to the
  catalog gbt_pred_yld_vs_wresid. Previously, the output had been incorrectly sent ot gbt_pred_vs_wresid.

  05/24/04 - Modified the graph_resids macro by substituting the name standardized for studentized.

  04/27/06 - Modified macro graph_resids: placed a quit command at the end of the last proc gplot
  and removed the run cancel command. This will eliminate the WARNING message that process was ended 
  at user request.


sparrow_compare_control_file.sas

  07/11/06 - Modified program to use the index command rather than the find command to make the program SAS 8
  compliant.

